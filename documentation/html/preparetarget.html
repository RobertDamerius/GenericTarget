<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Generic Target</title>
<link rel="stylesheet" href="core/design.css">

</head>
<body>
<header>
<div class="header_title">Generic Target</div>
<div class="header_version">Version 20240319</div>
</header>
<button onclick="PageToTop()" id="buttonToTop"></button>
<div class="wrapper">
<div class="navigation">
<ul class="ulnav">
<li class="linone"></li>
<li class="linav"><a href="index.html">Overview</a></li>
<li class="linone"></li>
<li class="litext">GETTING STARTED</li>
<li class="linav"><a href="installtoolbox.html">Install Generic Target Toolbox</a></li>
<li class="linav_active"><a href="preparetarget.html">Prepare Target Computer</a></li>
<li class="linav"><a href="createanddeploy.html">Create and Deploy a Model</a></li>
<li class="linone"></li>
<li class="litext">MATLAB PACKAGE</li>
<li class="linav"><a href="packages_gt_decodedatadirectory.html">GT.DecodeDataDirectory</a></li>
<li class="linav"><a href="packages_gt_decodedatafiles.html">GT.DecodeDataFiles</a></li>
<li class="linav"><a href="packages_gt_decodeindexfile.html">GT.DecodeIndexFile</a></li>
<li class="linav"><a href="packages_gt_generictarget.html">GT.GenericTarget (class)</a></li>
<li class="linav"><a href="packages_gt_gettemplate.html">GT.GetTemplate</a></li>
<li class="linone"></li>
<li class="litext">SIMULINK LIBRARY</li>
<li class="linav"><a href="library_gt_interface_udpsend.html">Interface / UDP Send</a></li>
<li class="linav"><a href="library_gt_interface_udpreceive.html">Interface / UDP Receive</a></li>
<li class="linav"><a href="library_gt_interface_multicastudpsend.html">Interface / Multicast UDP Send</a></li>
<li class="linav"><a href="library_gt_interface_multicastudpreceive.html">Interface / Multicast UDP Receive</a></li>
<li class="linav"><a href="library_gt_interface_writescalardoublestofile.html">Interface / Write Scalar Doubles To File</a></li>
<li class="linav"><a href="library_gt_interface_writebustofile.html">Interface / Write Bus To File</a></li>
<li class="linav"><a href="library_gt_time_modelexecutiontime.html">Time / Model Execution Time</a></li>
<li class="linav"><a href="library_gt_time_unixtime.html">Time / UNIX Time</a></li>
<li class="linav"><a href="library_gt_time_utctime.html">Time / UTC Time</a></li>
<li class="linav"><a href="library_gt_time_localtime.html">Time / Local Time</a></li>
<li class="linav"><a href="library_gt_time_taskexecutiontime.html">Time / Task Execution Time</a></li>
<li class="linav"><a href="library_gt_time_taskoverloads.html">Time / Task Overloads</a></li>
<li class="linav"><a href="library_gt_time_cpuoverloads.html">Time / CPU Overloads</a></li>
<li class="linav"><a href="library_gt_time_utctimestamp.html">Time / UTC Timestamp</a></li>
<li class="linav"><a href="library_gt_time_timetolatestutctimestamp.html">Time / Time To Latest UTC Timestamp</a></li>
<li class="linone"></li>
<li class="litext">EXAMPLES</li>
<li class="linav"><a href="example_deploymultiplemodels.html">Deploy Multiple Models</a></li>
<li class="linav"><a href="example_debugging.html">Debugging with Visual Studio Code</a></li>
<li class="linone"></li>
<li class="litext">HOW THE APPLICATION WORKS</li>
<li class="linav"><a href="application.html">Application Overview</a></li>
<li class="linav"><a href="timingscheduling.html">Timing & Scheduling</a></li>
<li class="linav"><a href="datarecording.html">Data Recording</a></li>
<li class="linav"><a href="protocolfile.html">Protocol File</a></li>
<li class="linone"></li>
<li class="litext">HOW THE DEPLOYMENT WORKS</li>
<li class="linav"><a href="deployment.html">Deployment Process</a></li>
</ul>

</div>
<div class="content">
<h1>Prepare Target Computer</h1>
    First the target computer must be prepared.
    For this purpose a linux-based operating system must be installed and configured on the target computer.
    Basically, any Linux distribution can be selected.
    Since all Linux distributions differ slightly from each other, no detailed instructions can be given here.
    Some packages may therefore already be installed, others still have to be installed.
    The next step is to generate SSH keys so that a host is able to login to the target without entering a password.
    The following steps must be performed.
    <br>
    <ul>
        <li><a href="#step1">Step 1: Install Linux OS</a></li>
        <li><a href="#step2">Step 2: Configure Linux</a></li>
        <li><a href="#step3">Step 3: Generate SSH Key for Autologin</a></li>
        <li><a href="#step4">Step 4: Optional Hardware Tuning and Advanced Options</a></li>
    </ul>

    <a name="step1"></a>
    <h2>Step 1: Install Linux OS</h2>
    It is recommended to use Debian, as this distribution is widely used and maintained and at the same time the realtime patch can be installed very easily via a single command.
    However, any other Linux distribution can also be used.
    Download a linux distribution of your choice and follow the instructions.
    Usually you need to create a bootable USB stick and boot from it.
    If available, the option to only do a minimal installation should be selected - without office applications and games.
    Furthermore, you can enable the SSH server during installation for most linux distributions.
    The Generic Target does not require a desktop environment.
    It is up to the user whether a graphical user interface should be available on the target computer or not.

    <a name="step2"></a>
    <h2>Step 2: Configure Linux</h2>
    At the beginning you can adjust basic settings.
    For example, the energy saving setting should be adjusted so that the computer does not automatically switch to standby mode.
    If your linux distribution does not come with <code>sudo</code>, then you have to install it. <code>sudo</code> is required to run
    application with administrator privileges.

        <h3>Install and configure sudo</h3>
        To install sudo, open a terminal and run
        <pre>su -l</pre>
        <pre>apt install sudo</pre>
        <pre>adduser UserName sudo</pre>
        where <code>UserName</code> is the user name of the computer.
        Afterwards reboot the system.
        In order to execute sudo commands via SSH without password request, edit the sudoers file for example with the nano editor by running
        <pre>sudo nano /etc/sudoers</pre>
        The line starting with "%sudo" must look like this
        <pre>%sudo   ALL=(ALL:ALL) NOPASSWD: ALL</pre>
        Save and close the file.

        <h3>Update path</h3>
        On some distributions like Debian, some command line executables are not in the path by default.
        Add those folders to the path variable by
        <pre>export PATH=$PATH:/sbin:/usr/sbin:/usr/local/sbin</pre>
        and reboot the system.

        <h3>Update system</h3>
        Connect the target to the internet and update the package database.
        <pre>sudo apt update</pre>
        If there're updates available, run
        <pre>sudo apt upgrade</pre>

        <h3>Install PREEMPT_RT patch</h3>
        The installation of the realtime kernel patch depends on the linux distribution used.
        Some distributions provide packages like <code>linux-image-realtime</code> or <code>linux-image-rt-amd64</code>.
        On debian for example, the realtime patch is installed by
        <pre>sudo apt install linux-image-rt-amd64</pre>
        After the new kernel has been installed, reboot the machine.
        To check if the realtime kernel is active, open a terminal and type <code>uname -a</code>.
        You should see something with "SMP PREEMPT_RT".

        <h3>Configure network buffers</h3>
        By default the network buffers for sending and receiving messages are limited to a fairly small value of about 100 KB or 200 KB depending on the distribution.
        To increase the maximum size of those buffers to 36 MB for each socket that is being created, run
        <pre>sudo sysctl -w net.core.rmem_max=33554432</pre>
        <pre>sudo sysctl -w net.core.wmem_max=33554432</pre>

        <h3>Install C++ Compiler + Tools</h3>
        Install the GNU compiler, build tools and C++ libraries with
        <pre>sudo apt install g++ make build-essential</pre>
        <div class="note-orange">
        <h3 class="note-orange">Note</h3>
        C++20 is required. Make sure that the installed g++ compiler supports the C++20 language features. You can check that by running <code>g++ -v -std=c++20</code>.
        If there's an error like <code>g++: error: unrecognized command line option '-std=c++20'</code>, then C++20 is not supported and you have to update the GNU compiler
        to the latest version.
        </div>

        <h3>Install SSH Server</h3>
        If the operating system does not come with an SSH server, install the OpenSSH server.
        <pre>sudo apt install openssh-server</pre>

        <h3>Install optional software</h3>
        Additional software can now be installed, e.g. tcpdump or wireshark.
        It is recommended to install network tools (for ping tests):
        <pre>sudo apt install net-tools</pre>

    <a name="step3"></a>
    <h2>Step 3: Generate SSH Key for Autologin</h2>
    <div class="note-orange">
    <h3 class="note-orange">Note</h3>
    On Linux this step is <b>recommended</b>. However, on Windows this step is <b>required</b> to allow ssh/scp commands to be executed from the
    MATLAB console.
    </div>

    While creating, starting and stopping an application on the target computer with the Generic Target Toolbox, commands are executed via SSH.
    The connection from the user PC to the target computer via SSH must be constantly authorized and confirmed with a password.
    Alternatively, keys can be generated and exchanged once.
    Those keys are then used to establish an SSH connection from one computer to another without the need to enter a password.
    SSH keys are stored in the home directory under <code>~/.ssh/</code>.
    This folder can be easily deleted to "forget" all previous SSH connections.
    The following commands are all executed on a user PC, i.e. the client that wants to connect to an SSH server on another computer, e.g. the target computer.

    <div class="note-green">
    <h3 class="note-green">Linux</h3>
        The following description applies only to Linux host computers, since some commands are not available on Windows.
        <h3>1. Generate Key</h3>
        With the command
        <pre>ssh-keygen</pre>
        a key is generated. Then you can specify a file name in which the key should be stored.
        With <code>RETURN</code> a default file name is used. Then you can specify a passphrase from which the key will be generated.
        With <code>RETURN</code> an empty passphrase is used. You can use the same key for several target computers.
        Thus, when setting up more targets, you can start with step 2.

        <h3>2. Copy Public Key to Target</h3>
        To copy the generated key (public key) to a target computer use the command
        <pre>ssh-copy-id -i ~/.ssh/id_rsa.pub UserName@RemoteServer</pre>
        Here <code>UserName</code> and <code>RemoteServer</code> must be replaced by the user name and IP address of the target computer, respectively.

        <h3>3. Add Private Key</h3>
        Now all that remains is to add a private key. To do this, execute the command
        <pre>ssh-add</pre>
        Establishing an SSH connection should now be done without asking for a password.
        For testing, make an SSH connection with the command <code>ssh UserName@RemoteServer</code>.
    </div>

    <div class="note-blue">
    <h3 class="note-blue">Windows</h3>
        <h3>1. Prepare</h3>
        Open PowerShell as an administrator and run
        <pre>Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0</pre>
        to install OpenSSH. Close the PowerShell. The remaining commands can be executed using a normal windows terminal.

        <h3>2. Generate Key</h3>
        With the command
        <pre>ssh-keygen</pre>
        a key is generated. Then you can specify a file name in which the key should be stored.
        With <code>RETURN</code> a default file name is used. Then you can specify a passphrase from which the key will be generated.
        With <code>RETURN</code> an empty passphrase is used. You can use the same key for several target computers.
        Thus, when setting up more targets, you can start with step 3.

        <h3>3. Copy Public Key to Target</h3>
        To copy the generated key (public key) to a target computer use the command
        <pre>scp C:\Users\HostName\.ssh\id_rsa.pub UserName@RemoteServer:</pre>
        where <code>HostName</code> is your host username and <code>UserName</code> and <code>RemoteServer</code> must be replaced by
        the user name and IP address of the target computer, respectively. Notice the <code>:</code> character at the end of the command.

        <h3>4. Configure Key</h3>
        Login to the target computer via SSH using
        <pre>ssh UserName@RemoteServer</pre>
        The following commands are all executed on the target computer.
        Next, make sure that the <code>.ssh</code> directory exists on the target. If not, you can create the directory with
        <pre>mkdir .ssh</pre>
        Append the uploaded public key to the authorized keys.
        <pre>cat id_rsa.pub >> .ssh/authorized_keys</pre>
        and delete the public key.
        <pre>rm id_rsa.pub</pre>
        The <code>.ssh</code> and <code>authorized_keys</code> directories must have the correct set of permissions.
        Execute the following commands
        <pre>chmod 700 ~/.ssh</pre>
        <pre>chmod 600 ~/.ssh/authorized_keys</pre>
        and run
        <pre>exit</pre>
        to logout. For testing, make an SSH connection from the host PC to the target computer with the command <code>ssh UserName@RemoteServer</code>.
    </div>

    <a name="step4"></a>
    <h2>Step 4: Optional Hardware Tuning and Advanced Options</h2>
    Now, some optional settings can be made to the BIOS and operating system to improve the performance and get the lowest possible worst-case latency.
    Here are some pointers to help guide you.
    In the BIOS, you may modify the following:
    <ul>
        <li>enable turbo boost if your system supports it</li>
        <li>disable CPU "C states" (CPU sleep states and CPU frequency scaling)</li>
        <li>disable any kind of energy saving options</li>
        <li>disable Hyper-Threading to avoid virtual CPU cores</li>
        <li>if you don't need USB, disable it</li>
    </ul>
    <h3>Update GRUB bootloader menu</h3>
    The GRUB menu may be updated to, e.g. reduce the timeout for the bootloader.
    On some operating systems this timeout is quite large, e.g. 10 seconds, to allow the user to read and select a boot option.
    To modify the bootload menu, e.g. with the nano editor, run
    <pre>sudo nano /etc/default/grub</pre>
    Once changes are made, update the bootloader via
    <pre>sudo update-grub</pre>
    The actual bootoptions that can be made may depend on the GRUB version and on the operating system.

    <h3>Isolating CPU cores</h3>
    The target application can be pinned to specific CPU cores.
    Via the GRUB bootloader menu, CPU cores can be isolated with the <code>isolcpus</code> option, which are then not occupied by operating system processes.
    These cores are then free.
    In this way, it is possible to restrict the operating system to certain cores and have the target application run on those isolated cores.
    For example, on a 4 cores CPU, you can leave core 0 and 1 to the OS and isolate core 2 and 3 by modifying the GRUB command line option as follows:
    <pre>GRUB_CMDLINE_LINUX_DEFAULT="quiet splash isolcpus=2,3"</pre>
    If you make changes to the bootloader menu, don't forget to run <code>sudo update-grub</code>.

</div>
</div>
<script src="core/script.js"></script>
</body>
</html>
